# 应用层
* [域名系统DNS](#域名系统DNS)     
  * [功能](#功能)     
  * [域名解析](#域名解析)     
  * [域名的层次结构](#域名的层次结构)     
  * [DNS可以使用UDP或者TCP进行传输](#DNS可以使用UDP或者TCP进行传输)     
* [文件传送协议FTP](#文件传送协议FTP)     
  * [功能](#功能)     
  * [组成](#组成)     
  * [主进程工作步骤](#主进程工作步骤)     
  * [控制连接和数据连接](#控制连接和数据连接)     
  * [主动模式和被动模式](#主动模式和被动模式)     
* [电子邮件系统](#电子邮件系统)     
  * [组成](#组成)     
  * [SMTP](#SMTP)     
  * [POP3](#POP3)     
  * [IMAP](#IMAP)     
  * [常用端口](#常用端口)     
* [浏览器输入URL后执行的全部过程](#浏览器输入URL后执行的全部过程)     
  * [1.DNS域名解析](#1-DNS域名解析)     
  * [2.建立TCP连接](#2-建立TCP连接)     
  * [3.发送HTTP请求报文](#3-发送HTTP请求报文)     
  * [4.服务器处理请求](#4-服务器处理请求)     
  * [5.返回HTTP响应报文](#5-返回HTTP响应报文)     
  * [6.浏览器解析HTML代码并请求其中的资源图片等](#6-浏览器解析HTML代码并请求其中的资源图片等)     
  * [7.释放TCP连接](#7-释放TCP连接)     
  * [8.浏览器渲染页面呈现给用户](#8-浏览器渲染页面呈现给用户)     


# 域名系统DNS
## 功能
DNS是一个分布式数据库（每个站点只保留它自己的那部分数据），从域名解析出IP地址，提供了主机名和IP地址之间相互转换的服务。

## 域名解析
* 当某一个应用进程需要把主机名解析为IP地址时，该应用进程就调用解析程序，并成为DNS的一个客户；
* 把待解析的域名放在DNS请求报文中，以**UDP用户数据报**方式发给本地域名服务器；
* 本地域名服务器查找域名后，把对应的IP地址放在回答报文中返回；
* 应用进程获得目的主机的IP地址后，即可进行通信；

## 域名的层次结构
从上到下依次为：根域名、顶级域名、二级域名。
![image6-1](media/15930520394019/image6-1.png)

## DNS可以使用UDP或者TCP进行传输
* 使用的端口号都为53；
* 大多数情况下用UDP进行传输，这就要求域名解析器和域名服务器都必须自己处理超时和重传从而保证可靠性；
* 下列两种情况用TCP传输：
    * 返回的响应超过512字节，因为UDP最大支持512字节的数据；
    * 区域传送，是主域名服务器向辅助域名服务器传送变化的那部分数据；

# 文件传送协议FTP
## 功能
* 提供文件传送的一些基本服务；
* 减少或消除在不同操作系统下处理文件不兼容性；

## 组成
* 主进程：接受新的请求；
* 从属进程：处理单个请求；

## 主进程工作步骤
* 打开熟知端口，端口号为21，等待客户进程发送连接请求；
* 启动从属进程以处理客户进程发来的请求；
* 处理后立即终止；
* 回等待状态，主从进程是并发进行的；

## 控制连接和数据连接
FTP使用TCP进行连接，需要两个连接来传送一个文件。
* 控制连接：服务器打开端口号21等待客户端的连接，客户端主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答；
* 数据连接：用来传送一个文件数据；

## 主动模式和被动模式
根据数据连接是否是服务器端主动建立。
* 主动模式：服务器端主动建立数据连接，其中服务器端的端口号是20，客户端的端口号随机，但是必须大于1024，因为0~1023是熟知端口号；
（要求客户端开放端口号给服务器端，需要去配置客户端的防火墙。）
---

* 被动模式：客户端主动建立数据连接，其中客户端的端口号由客户端自己指定，服务器端的端口号随机；
（只需要服务器端开放端口号即可，无需客户端配置防火墙，但是会导致服务器端的安全性减弱，因为开放了过多的端口号。）

# 电子邮件系统
## 组成
三部分：用户代理，邮件服务器，邮件协议（发送协议SMTP，读取协议常用POP3和IMAP）。
![image6-2](media/15930520394019/image6-2.jpg)

##  SMTP
* 只能发ASCII码；
* 而互联网邮件扩充MIME可以发送二进制文件；
* MIME并没有改动或者取代SMTP，而是增加邮件主体的结构，定义了非ASCII码的编程规则。
![image6-3](media/15930520394019/image6-3.png)

## POP3
* 特点是只要用户从服务器上读取了邮件，就把该邮件删除；
* 最新版本的POP3可以不删除邮件；

## IMAP
* IMAP协议中客户端和服务器中的邮件保持同步；
* 如果不手动删除邮件，那么服务器上的邮件也不会被删除；
* IMAP这种做法可以让用户随时随地去访问服务器上的邮件；

## 常用端口
![image6-4](media/15930520394019/image6-4.png)

# 浏览器输入URL后执行的全部过程
## 1.DNS域名解析
`域名 -> IP地址`
* 1⃣️搜索浏览器自身的DNS缓存；
* 2⃣️如果自身的缓存里没有找到，就搜索系统自身的DNS缓存；
* 3⃣️如果还没有找到，就尝试到hosts文件里去找；
* 4⃣️如果还没有找到，就**递归**的到域名服务器中去找（一步步的向根域名服务器去找，递归到下一级，根域名服务器，递归查找到之后，将得到的IP地址返回给操作系统，同时自己也将IP地址缓存起来，操作系统将IP地址返回给浏览器，同时自己也将IP地址缓存起来，至此浏览器已经得到了域名对应的IP地址）；

## 2.建立TCP连接
`TCP三次握手`

## 3.发送HTTP请求报文
由三部分组成：请求行，请求头，请求正文。
* 请求行：用于描述客户端的请求方式，请求的资源名称，使用的HTTP协议的版本号；
* 请求头：描述客户端请求哪台主机，以及客户端的一些环境信息等；
* 请求正文：当使用post，put等方法时，通常需要客户端向服务器传递数据，这些数据就存在请求正文中，get方式是保存在url地址后面，不会放在这里；

## 4.服务器处理请求

## 5.返回HTTP响应报文
由三部分组成：状态码，响应头，实体内容。
* 状态码：用于表示服务器对请求的处理结果：
    * 200:没有问题；
    * 302:要你去找别人；
    * 304:要你去拿缓存；
    * 307:要你去拿缓存；
    * 403:有这个资源，但是没有访问权限；
    * 404:服务器没有这个资源；
    * 500:服务器这边有问题；
* 响应头：用于描述服务器的基本信息，以及客户端如何处理数据；
* 实体内容：服务器返回给客户端的数据；

## 6.浏览器解析HTML代码并请求其中的资源图片等
看是否是长连接，来决定是不是断开TCP连接


## 7.释放TCP连接
`TCP四次挥手`


## 8.浏览器渲染页面呈现给用户



